<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.KoreaIT.sdy.demo.repository.ChatRepository">

	<select id="getRooms" resultType="com.KoreaIT.sdy.demo.dto.ChatRoom">
		SELECT *
		FROM ChatRoom
	</select>

	<select id="getRoomById" resultType="com.KoreaIT.sdy.demo.dto.ChatRoom">
		SELECT *
		FROM chatRoom
		WHERE id = #{id}
	</select>
	
	<insert id="createChatRoom">
		INSERT INTO chatRoom
		SET roomName = #{roomName};
	</insert>

	<update id="plusUserCnt">
		UPDATE chatRoom
		SET userCount = userCount + 1
		WHERE id = #{id};
	</update>

	<update id="minusUserCnt">
		UPDATE chatRoom
		SET userCount = userCount - 1
		WHERE id = #{id};
	</update>

	<insert id="addUser">
		INSERT INTO chat_user
		SET roomId = #{roomId},
		userName = #{userName},
		memberId = #{memberId};
	</insert>
	
	<delete id="delUser">
		DELETE FROM chat_user
		WHERE roomId = #{roomId}
		AND memberId = #{memberId};
	</delete>
	
	<insert id="saveChat">
		INSERT INTO chat 
		SET `type` = #{type},
		roomId = #{roomId},
		sender = #{sender},
		memberId = #{memberId},
		message = #{message},
		`time` = #{time};
	</insert>

	<select id="getUserName" resultType="String">
		SELECT userName
		FROM chat_user
		WHERE roomId = #{roomId}
		AND memberId = #{memberId};
	</select>
	
	<select id="getUserList" resultType="String">
		SELECT userName
		FROM chat_user;
	</select>

	<select id="getLastInsertId" resultType="int">
		SELECT LAST_INSERT_ID()
	</select>
	
</mapper>